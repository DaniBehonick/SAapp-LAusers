---
title: "SA app user data Latin America 1Dec20-1Jan22"
author: "Dani Behonick"
date: "2/2/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
install.packages("readr")
install.packages("dplyr")
install.packages("ggplot2")
library(readr)
library(dplyr)
library(ggplot2)
```
*NEW USERS*
```{r}
LAnewusers_Dec20Jan22 <- read.csv("newusers_20201201to20220101.csv",
skip = 1, head = FALSE, sep = ",")
```

*Data cleaning*
```{r}
#columns renamed
colnames(LAnewusers_Dec20Jan22) <- c("Country_ID", "2021_01",
"2020_12", "2021_06", "2021_11", "2021_05", "2021_02", "2021_08",
"2021_12", "2021_07", "2021_10", "2021_09", "2021_04", "2021_03",
"2022_01", "Totals")

#header rows and data entries for non-Wyss LA countries removed
LAnewusers_Dec20Jan22 <- LAnewusers_Dec20Jan22 %>%
filter(Country_ID == "MX" | Country_ID == "AR" | Country_ID == "CO" |
Country_ID == "GT" | Country_ID == "HN" | Country_ID == "PE" |
Country_ID == "EC")

#transposed rows/columns
LAnewusers_Dec20Jan22_2 <- t(LAnewusers_Dec20Jan22[-1])
colnames(LAnewusers_Dec20Jan22_2) <- LAnewusers_Dec20Jan22[, 1]

#making time a recognized column variable
LAnewusers_Dec20Jan22_2 <- cbind(rownames(LAnewusers_Dec20Jan22_2), 
  LAnewusers_Dec20Jan22_2)
rownames(LAnewusers_Dec20Jan22_2) <- NULL

#Totals row removed
LAnewusers_Dec20Jan22_2 <- LAnewusers_Dec20Jan22_2[-c(15), ]

#make it a dataframe
LAnewusers_Dec20Jan22_2 <- as.data.frame(LAnewusers_Dec20Jan22_2)
```

```{r}
install.packages("tidyr")
library(tidyr)
```
```{r}
#pivot to make CountryID a callable variable
LAnewusers_Dec20Jan22_3 <- pivot_longer(LAnewusers_Dec20Jan22_2, cols=2:8, names_to = "Country", values_to = "New_users")

#rename columns
colnames(LAnewusers_Dec20Jan22_3) <- c("Year_Month","CountryID","New_Users")

#make it a dataframe
LAnewusers_Dec20Jan22_3 <- as.data.frame(LAnewusers_Dec20Jan22_3)
```

```{r}
#coerce New_Users to numeric variable rather than character
typeof(LAnewusers_Dec20Jan22_3$New_Users)
LAnewusers_Dec20Jan22_3$New_Users <- as.numeric(LAnewusers_Dec20Jan22_3$New_Users)
typeof(LAnewusers_Dec20Jan22_3$New_Users)

#make Month_Year a date/time object
install.packages("zoo")
library(zoo)
Year_Month <- LAnewusers_Dec20Jan22_3$Year_Month
Year_Month_2 <- as.yearmon(as.character(Year_Month), "%Y_%m")
LAnewusers_Dec20Jan22_3[ , 'Year_Month'] <- Year_Month_2
typeof(LAnewusers_Dec20Jan22_3$Year_Month)
```


```{r}
#jpeg('LAnewusers_Dec20Jan22_3.jpg')
ggplot(data = LAnewusers_Dec20Jan22_3, aes(x=Year_Month, y=New_Users)) + 
  geom_line(aes(color=CountryID)) + labs(x = "Time", y = "New Users", 
  title = "Total new users, LA Wyss countries, 2020Dec-2022Jan") + 
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))
```
*RETURN USERS*
```{r}
LAreturningusers_Dec20Jan22 <- read.csv("returningusers_20201201to20220101.csv",
skip = 1, head = FALSE, sep = ",")
```

*Data cleaning*
```{r}
#columns renamed
colnames(LAreturningusers_Dec20Jan22) <- c("Country_ID", "2021_01",
"2020_12", "2021_02", "2021_05", "2021_06", "2021_04", "2021_03",
"2021_12", "2021_10", "2021_07", "2021_11", "2021_09", "2022_01", "Totals")

#header rows and data entries for non-Wyss LA countries removed
LAreturningusers_Dec20Jan22 <- LAreturningusers_Dec20Jan22 %>%
filter(Country_ID == "MX" | Country_ID == "AR" | Country_ID == "CO" |
Country_ID == "GT" | Country_ID == "HN" | Country_ID == "PE" |
Country_ID == "EC")

#transposed rows/columns
LAreturningusers_Dec20Jan22_2 <- t(LAreturningusers_Dec20Jan22[-1])
colnames(LAreturningusers_Dec20Jan22_2) <- LAreturningusers_Dec20Jan22[, 1]

#making time a recognized column variable
LAreturningusers_Dec20Jan22_2 <- cbind(rownames(LAreturningusers_Dec20Jan22_2), 
  LAreturningusers_Dec20Jan22_2)
rownames(LAreturningusers_Dec20Jan22_2) <- NULL

#Totals row removed
LAreturningusers_Dec20Jan22_2 <- LAreturningusers_Dec20Jan22_2[-c(14), ]

#make it a dataframe
LAreturningusers_Dec20Jan22_2 <- as.data.frame(LAreturningusers_Dec20Jan22_2)

#pivot to make CountryID a callable variable
LAreturningusers_Dec20Jan22_3 <- pivot_longer(LAreturningusers_Dec20Jan22_2, cols=2:8, names_to = "Country", values_to = "Returning_users")

#rename columns
colnames(LAreturningusers_Dec20Jan22_3) <- c("Year_Month","CountryID","Returning_Users")

#make it a dataframe
LAreturningusers_Dec20Jan22_3 <- as.data.frame(LAreturningusers_Dec20Jan22_3)

#coerce Returning_Users to numeric variable rather than character
LAreturningusers_Dec20Jan22_3$Returning_Users <- as.numeric(LAreturningusers_Dec20Jan22_3$Returning_Users)
typeof(LAreturningusers_Dec20Jan22_3$Returning_Users)

#make Month_Year a date/time object
Year_Month_returning <- LAreturningusers_Dec20Jan22_3$Year_Month
Year_Month_returning_2 <- as.yearmon(as.character(Year_Month_returning), "%Y_%m")
LAreturningusers_Dec20Jan22_3[ , 'Year_Month'] <- Year_Month_returning_2
typeof(LAreturningusers_Dec20Jan22_3$Year_Month)

#jpeg('LAreturningusers_Dec20Jan22_3.jpg')
ggplot(data = LAreturningusers_Dec20Jan22_3, aes(x=Year_Month, y=Returning_Users)) + 
  geom_line(aes(color=CountryID)) + labs(x = "Year_Month", y = "Returning Users", 
  title = "Total returning users, LA Wyss countries, 2020Dec-2022Jan") + 
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))
```

*TOTAL USERS*
```{r}
LAtotalusers_Dec20Jan22 <- read.csv("totalusers_20201201to20220101.csv",
skip = 1, head = FALSE, sep = ",")
```

*Data cleaning*
```{r}
#columns renamed
colnames(LAtotalusers_Dec20Jan22) <- c("Country_ID", "2021_01",
"2020_12", "2021_02", "2021_08", "2021_12", "2021_11", "2021_06",
"2021_07", "2021_05", "2021_09", "2021_10", "2021_04", "2021_03", "2022_01", "Totals")

#header rows and data entries for non-Wyss LA countries removed
LAtotalusers_Dec20Jan22 <- LAtotalusers_Dec20Jan22 %>%
filter(Country_ID == "MX" | Country_ID == "AR" | Country_ID == "CO" |
Country_ID == "GT" | Country_ID == "HN" | Country_ID == "PE" |
Country_ID == "EC")

#transposed rows/columns
LAtotalusers_Dec20Jan22_2 <- t(LAtotalusers_Dec20Jan22[-1])
colnames(LAtotalusers_Dec20Jan22_2) <- LAtotalusers_Dec20Jan22[, 1]

#making time a recognized column variable
LAtotalusers_Dec20Jan22_2 <- cbind(rownames(LAtotalusers_Dec20Jan22_2), 
  LAtotalusers_Dec20Jan22_2)
rownames(LAtotalusers_Dec20Jan22_2) <- NULL

#Totals row removed
LAtotalusers_Dec20Jan22_2 <- LAtotalusers_Dec20Jan22_2[-c(15), ]

#make it a dataframe
LAtotalusers_Dec20Jan22_2 <- as.data.frame(LAtotalusers_Dec20Jan22_2)

#pivot to make CountryID a callable variable
LAtotalusers_Dec20Jan22_3 <- pivot_longer(LAtotalusers_Dec20Jan22_2, cols=2:8, names_to = "Country", values_to = "Total_users")

#rename columns
colnames(LAtotalusers_Dec20Jan22_3) <- c("Year_Month","CountryID","Total_Users")

#make it a dataframe
LAtotalusers_Dec20Jan22_3 <- as.data.frame(LAtotalusers_Dec20Jan22_3)

#coerce Total_Users to numeric variable rather than character
LAtotalusers_Dec20Jan22_3$Total_Users <- as.numeric(LAtotalusers_Dec20Jan22_3$Total_Users)
typeof(LAtotalusers_Dec20Jan22_3$Total_Users)

#make Month_Year a date/time object
Year_Month_total <- LAtotalusers_Dec20Jan22_3$Year_Month
Year_Month_total_2 <- as.yearmon(as.character(Year_Month_total), "%Y_%m")
LAtotalusers_Dec20Jan22_3[ , 'Year_Month'] <- Year_Month_total_2
typeof(LAtotalusers_Dec20Jan22_3$Year_Month)

#jpeg('LAtotalusers_Dec20Jan22_3.jpg')
ggplot(data = LAtotalusers_Dec20Jan22_3, aes(x=Year_Month, y=Total_Users)) + 
  geom_line(aes(color=CountryID)) + labs(x = "Year_Month", y = "Total Users", 
  title = "Total users, LA Wyss countries, 2020Dec-2022Jan") + 
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))
```

*PREDICTING FUTURE USE*
New users
```{r}
newusers_lm <- lm(New_Users~Year_Month, LAnewusers_Dec20Jan22_3)

New_dates <- data.frame(Year_Month= c("2022_04", "2022_07"))
New_Year_Month <- New_dates$Year_Month
New_Year_Month_2 <- as.yearmon(as.character(New_Year_Month), "%Y_%m")
New_dates[ , 'Year_Month'] <- New_Year_Month_2
typeof(New_dates$Year_Month)

New_users_prediction_col <- predict(newusers_lm, New_dates)
New_users_prediction <- cbind(New_dates, New_users_prediction_col)
```

New users, MX
```{r, New users MX}
LAnewusers_Dec20Jan22_3_MX <- LAnewusers_Dec20Jan22_3 %>% filter(CountryID == "MX")

newusers_MX_lm <- lm(New_Users~Year_Month, LAnewusers_Dec20Jan22_3_MX)

New_dates <- data.frame(Year_Month= c("2022_04", "2022_07"))
New_Year_Month <- New_dates$Year_Month
New_Year_Month_2 <- as.yearmon(as.character(New_Year_Month), "%Y_%m")
New_dates[ , 'Year_Month'] <- New_Year_Month_2
typeof(New_dates$Year_Month)

New_users_prediction_col_MX <- predict(newusers_MX_lm, New_dates)
New_users_prediction_MX <- cbind(New_dates, New_users_prediction_col_MX)
```

New users, AR
```{r, New users AR}
LAnewusers_Dec20Jan22_3_AR <- LAnewusers_Dec20Jan22_3 %>% filter(CountryID == "AR")

newusers_AR_lm <- lm(New_Users~Year_Month, LAnewusers_Dec20Jan22_3_AR)

New_users_prediction_col_AR <- predict(newusers_AR_lm, New_dates)
New_users_prediction_AR <- cbind(New_dates, New_users_prediction_col_AR)
```

New users, CO
```{r, New users CO}
LAnewusers_Dec20Jan22_3_CO <- LAnewusers_Dec20Jan22_3 %>% filter(CountryID == "CO")

newusers_CO_lm <- lm(New_Users~Year_Month, LAnewusers_Dec20Jan22_3_CO)

New_users_prediction_col_CO <- predict(newusers_CO_lm, New_dates)
New_users_prediction_CO <- cbind(New_dates, New_users_prediction_col_CO)
```

New users, GT
```{r, New users GT}
LAnewusers_Dec20Jan22_3_GT <- LAnewusers_Dec20Jan22_3 %>% filter(CountryID == "GT")

newusers_GT_lm <- lm(New_Users~Year_Month, LAnewusers_Dec20Jan22_3_GT)

New_users_prediction_col_GT <- predict(newusers_GT_lm, New_dates)
New_users_prediction_GT <- cbind(New_dates, New_users_prediction_col_GT)